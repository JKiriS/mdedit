<!DOCTYPE html>
<html>
<head>
	<title>PW demo</title>
	<script type="text/javascript" src="d3.min.js"></script>
	<script type="text/javascript" src="jquery-1.11.1.min.js"></script>
	<style type="text/css">
		
		.link {
		  stroke: #000;
		  stroke-width: 0.5px;
		}

	</style>
</head>
<body>

</body>

<script type="text/javascript">
var width = 960,
	height = 500;

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var color = d3.scale.category20();

var nodes = d3.range(13).map(function(i) {
	  r = 20;
	  return {
		  	index: i, 
		  	x: r + Math.floor(Math.random() * (width-r*2)),
		  	y: r + Math.floor(Math.random() * (height-r*2)),
		  	tx: r + Math.floor(Math.random() * (width-r*2)),
		  	ty: r + Math.floor(Math.random() * (height-r*2)),
		  	r: r
		  };
	});

var links = [
    {"source":  0, "target":  1},
    {"source":  1, "target":  2},
    {"source":  2, "target":  0},
    {"source":  1, "target":  3},
    {"source":  3, "target":  2},
    {"source":  3, "target":  4},
    {"source":  4, "target":  5},
    {"source":  5, "target":  6},
    {"source":  5, "target":  7},
    {"source":  6, "target":  7},
    {"source":  6, "target":  8},
    {"source":  7, "target":  8},
    {"source":  9, "target":  4},
    {"source":  9, "target": 11},
    {"source":  9, "target": 10},
    {"source": 10, "target": 11},
    {"source": 11, "target": 12},
    {"source": 12, "target": 10}
  ];

var drag = d3.behavior.drag()
	.origin(function(d) { return nodes[d.index]; })
    .on("drag", dragmove)
    .on("dragstart", dragstart);

function dragmove(d) {
	d.x = Math.max(d.r, Math.min(width - d.r, d3.event.x));
	d.y = Math.max(d.r, Math.min(height - d.r, d3.event.y));

	update();
}

function dragstart(d) {
	d.fixed = true;
}

function dblclick(d) {
    d.fixed = false;
}

function update(){
	svg.selectAll(".link").data(links)
	  	.attr("x1", function(d) { return nodes[d.source].x; })
	    .attr("y1", function(d) { return nodes[d.source].y; })
	    .attr("x2", function(d) { return nodes[d.target].x; })
	    .attr("y2", function(d) { return nodes[d.target].y; });

	svg.selectAll(".node").data(nodes)
      .attr("r", function(d) { return d.r; })
      .attr("fill", function(d, i) { return color(i); })
      .attr("cx", function(d) { return d.x; })
      .attr("cy", function(d) { return d.y; });
    
}

svg.selectAll(".link").data(links)
	.enter().append("line")
  	.attr("class", "link");

svg.selectAll(".node").data(nodes)
	.enter().append("circle")
	.attr("class", "node")
	.on("dblclick", dblclick)
    .call(drag);

update();

function dynamic(){
	nodes.forEach(function(d, i){
		k = .5;
		if(d.fixed)
			return ;
		if(d.x != d.tx) {
			d.x += d.x > d.tx ? -k: k;
		}
		if(d.y != d.ty) {
			d.y += d.y > d.ty ? -k: k;
		}
		if(d.x == d.tx && d.y == d.ty){
			d.tx = d.r + Math.floor(Math.random() * (width-d.r*2));
			d.ty = d.r + Math.floor(Math.random() * (height-d.r*2));
		}
		update();
	});
}

d3.timer(dynamic);

</script>

</html>